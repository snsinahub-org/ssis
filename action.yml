name: 'action yml'
description: 'dotnet restore'
inputs:
  project_path:  
    description: 'path'
    required: true
  project_configuration:  
    description: 'test-path'
    required: true
  output_path:  
    description: 'newTag'
    required: true  
  ssis_action:  
    description: 'newTag'
    required: true
outputs:
  random-number:
    description: "Random number"
    value: ${{ steps.random-number-generator.outputs.random-number }}
runs:
  using: "composite"
  steps:
    - run: |
        $Env:PATH += ";C:\Program Files (x86)\Microsoft Visual Studio\Installer"
        $VS_FILE = vswhere -products * -format json | jq '.[0]' | jq .productPath
        $TMP = Split-Path -Path $VS_FILE.replace('\\', '\')
        $VS_PATH = $TMP.replace('"', '')
        $Env:PATH += ";$VS_PATH"
        cd "${{ inputs.project_path }}"
        Get-ChildItem -Path .\ -Filter *.dtproj -Recurse -File -Name| ForEach-Object {
          $proj = "${{ inputs.project_path }}\" + $_
          echo $proj
          devenv "$proj" /build "${{ inputs.project_configuration }}" /Project $_
        }
        C:\Windows\System32\robocopy.exe "${{ inputs.project_path }}\bin\${{ inputs.project_configuration }}" "${{ inputs.output_path }}" /s /r:10        
      shell: powershell
      if: ${{ inputs.ssis_action == 'build' }}
